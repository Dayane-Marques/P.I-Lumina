<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Ca√ßa-Palavras da Lumina</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="cssJogos/estilo-ca√ßapalavras.css">
</head>

<body>
    <a href="jogos.html" class="btn-voltar">‚Üê Voltar</a>

    <h1>üß© Ca√ßa-Palavras da Prote√ß√£o</h1>
    <div class="intro">
        Encontre palavras que te ajudam a cuidar do seu corpo.<br>
        <strong>Lembre-se: voc√™ tem o direito de dizer N√ÉO ‚Äî e ser ouvido(a).</strong>
    </div>

    <div id="controls">
        <button id="newGameBtn" aria-label="Novo jogo">Novo jogo</button>
        <button id="clearSelBtn" aria-label="Limpar sele√ß√£o atual">Limpar sele√ß√£o</button>
        <div id="status" aria-live="polite"></div>
    </div>

    <div id="wordList"></div>
    <div id="grid" role="grid" aria-label="Tabuleiro do ca√ßa palavras"></div>

    <div id="completionArea" aria-live="polite">
        <div class="msg"></div>
        <button id="playAgainBtn">Jogar novamente</button>
    </div>

    <script>
        /* =======================
           PALAVRAS DE EMPODERAMENTO
           ======================= */
        const palavras = [
            "N√ÉO",
            "CORPO",
            "RESPEITO",
            "CONSENTIMENTO",
            "DIREITOS",
            "CONFIAN√áA",
            "AJUDA",
            "LUMINA"
        ];

        // Palavras que merecem destaque especial (amarelo-luz)
        const powerWords = new Set(["N√ÉO", "CONSENTIMENTO", "DIREITOS"]);

        const tamanho = 14;
        const letras = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        const maxWordLen = Math.max(...palavras.map(p => p.length));
        let grade = [];
        let foundWords = new Set();
        const direcoes = [[1, 0], [-1, 0], [0, 1], [0, -1], [1, 1], [-1, -1], [1, -1], [-1, 1]];
        let cellEls = [];
        let selecionados = [];
        let dirSel = null;

        function novaGradeVazia() {
            return Array.from({ length: tamanho }, () => Array(tamanho).fill(""));
        }

        function colocarPalavras() {
            for (const palavra of palavras) {
                let colocada = false;
                let tentativas = 0;
                while (!colocada) {
                    tentativas++;
                    if (tentativas > 2000) {
                        grade = novaGradeVazia();
                        tentativas = 0;
                    }
                    const [dr, dc] = direcoes[Math.floor(Math.random() * direcoes.length)];
                    const linha = Math.floor(Math.random() * tamanho);
                    const col = Math.floor(Math.random() * tamanho);

                    let pode = true;
                    for (let i = 0; i < palavra.length; i++) {
                        const nl = linha + dr * i;
                        const nc = col + dc * i;
                        if (nl < 0 || nl >= tamanho || nc < 0 || nc >= tamanho) { pode = false; break; }
                        if (grade[nl][nc] && grade[nl][nc] !== palavra[i]) { pode = false; break; }
                    }

                    if (pode) {
                        for (let i = 0; i < palavra.length; i++) {
                            const nl = linha + dr * i;
                            const nc = col + dc * i;
                            grade[nl][nc] = palavra[i];
                        }
                        colocada = true;
                    }
                }
            }
        }

        function completarGrade() {
            for (let i = 0; i < tamanho; i++) {
                for (let j = 0; j < tamanho; j++) {
                    if (!grade[i][j]) {
                        grade[i][j] = letras[Math.floor(Math.random() * letras.length)];
                    }
                }
            }
        }

        function limparWordList() {
            const wordList = document.getElementById("wordList");
            wordList.innerHTML = "";
            for (const w of palavras) {
                const span = document.createElement("span");
                span.className = "word";
                span.id = "word_" + w;
                span.textContent = w;
                wordList.appendChild(span);
            }
        }

        function gerarInterface() {
            const grid = document.getElementById("grid");
            grid.innerHTML = "";
            grid.tabIndex = 0;
            cellEls = Array.from({ length: tamanho }, () => Array(tamanho).fill(null));

            for (let i = 0; i < tamanho; i++) {
                for (let j = 0; j < tamanho; j++) {
                    const div = document.createElement("div");
                    div.className = "cell";
                    div.dataset.linha = i;
                    div.dataset.col = j;
                    div.setAttribute("role", "gridcell");
                    div.setAttribute("tabindex", "0");
                    div.textContent = grade[i][j];
                    div.addEventListener("click", onClickCell);
                    div.addEventListener("keydown", onKeyCell);
                    grid.appendChild(div);
                    cellEls[i][j] = div;
                }
            }
        }

        function setStatus(msg) {
            document.getElementById("status").textContent = msg || "";
        }

        function isAdjacent(r1, c1, r2, c2) {
            const dr = Math.abs(r2 - r1);
            const dc = Math.abs(c2 - c1);
            return (dr <= 1 && dc <= 1 && !(dr === 0 && dc === 0));
        }

        function addSelection(el, r, c) {
            el.classList.add("selected");
            selecionados.push({ el, r, c });
            if (selecionados.length === 2) {
                const a = selecionados[0], b = selecionados[1];
                dirSel = { dr: Math.sign(b.r - a.r), dc: Math.sign(b.c - a.c) };
            }
        }

        function popSelection() {
            const last = selecionados.pop();
            if (last) last.el.classList.remove("selected");
            if (selecionados.length < 2) dirSel = null;
        }

        function clearSelection() {
            selecionados.forEach(s => s.el.classList.remove("selected"));
            selecionados = [];
            dirSel = null;
        }

        function lockSelectionAsCorrect(word) {
            const usePower = powerWords.has(word);
            selecionados.forEach(s => {
                s.el.classList.remove("selected");
                s.el.classList.add("locked");
                if (usePower) s.el.classList.add("correct-power");
                else s.el.classList.add("correct");
            });

            const wordEl = document.getElementById("word_" + word);
            if (wordEl) {
                wordEl.classList.add("found");
                if (usePower) wordEl.classList.add("found-power");
            }

            foundWords.add(word);
            setStatus(`‚úÖ Encontrou: ${word}`);

            if (foundWords.size === palavras.length) {
                document.querySelector("#completionArea .msg").innerHTML =
                    "Parab√©ns! Voc√™ encontrou as palavras da prote√ß√£o.<br><br>" +
                    "<strong>Voc√™ tem o direito de:</strong><br>" +
                    "‚Ä¢ Decidir quem toca seu corpo<br>" +
                    "‚Ä¢ Dizer N√ÉO sem culpa<br>" +
                    "‚Ä¢ Ser ouvido(a) por adultos<br><br>" +
                    "Se algo te deixar desconfort√°vel, conte para algu√©m de confian√ßa.<br>" +
                    "A Lumina acredita em voc√™. ‚ú®";
                document.getElementById("completionArea").classList.add("show");
            }

            selecionados = [];
            dirSel = null;
        }

        function currentSelectedString() {
            return selecionados.map(s => s.el.textContent).join("");
        }

        function checkMatchAndFinalize() {
            const palavra = currentSelectedString();
            for (const w of palavras) {
                if (foundWords.has(w)) continue;
                if (palavra === w || palavra === w.split("").reverse().join("")) {
                    lockSelectionAsCorrect(w);
                    return true;
                }
            }
            return false;
        }

        function onClickCell(e) {
            const el = e.currentTarget;
            if (el.classList.contains("locked")) return;

            const r = +el.dataset.linha;
            const c = +el.dataset.col;

            if (selecionados.length > 0) {
                const last = selecionados[selecionados.length - 1];
                if (last.r === r && last.c === c) {
                    popSelection();
                    setStatus("");
                    return;
                }
            }

            if (selecionados.length === 0) {
                addSelection(el, r, c);
                setStatus("");
                return;
            }

            const last = selecionados[selecionados.length - 1];
            if (!isAdjacent(last.r, last.c, r, c)) {
                clearSelection();
                addSelection(el, r, c);
                setStatus("");
                return;
            }

            if (!dirSel) {
                const dr = Math.sign(r - last.r);
                const dc = Math.sign(c - last.c);
                dirSel = { dr, dc };
                addSelection(el, r, c);
            } else {
                const expectedR = last.r + dirSel.dr;
                const expectedC = last.c + dirSel.dc;
                if (r !== expectedR || c !== expectedC) {
                    clearSelection();
                    addSelection(el, r, c);
                    setStatus("");
                    return;
                }
                addSelection(el, r, c);
            }

            if (checkMatchAndFinalize()) return;
            if (selecionados.length > maxWordLen) {
                clearSelection();
                setStatus("Sele√ß√£o limpa (muito longa).");
            } else {
                setStatus("");
            }
        }

        function onKeyCell(e) {
            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                e.currentTarget.click();
            } else if (e.key === "Escape") {
                clearSelection();
                setStatus("Sele√ß√£o limpa.");
            }
        }

        document.getElementById("clearSelBtn").addEventListener("click", () => {
            clearSelection();
            setStatus("Sele√ß√£o limpa.");
        });

        document.getElementById("newGameBtn").addEventListener("click", iniciarNovoJogo);
        document.getElementById("playAgainBtn").addEventListener("click", iniciarNovoJogo);

        function iniciarNovoJogo() {
            foundWords = new Set();
            grade = novaGradeVazia();
            colocarPalavras();
            completarGrade();
            limparWordList();
            gerarInterface();
            clearSelection();
            setStatus("Novo jogo iniciado.");
            document.getElementById("completionArea").classList.remove("show");
        }

        iniciarNovoJogo();
    </script>

    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>
    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>
</body>

</html>